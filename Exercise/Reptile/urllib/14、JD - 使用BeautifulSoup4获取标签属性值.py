# -*- coding:utf-8 -*-
'''

知识点：


    1、使用 BeautifulSoup4 获取页面元素的属性值

        BeautifulSoup4 和 XPath、正则 一样，都是解析 HTML 页面标签的

        BeautifulSoup4 DOC 地址：
            http://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/#css

'''


'''

nloginpwd=NqzCANUyreHqy5d%2BcniNCXsZduaEJqu9eD7zGX7FdAvsMrP2OaKcsJ4GOIKgM%2F6Ver19Ez2HWc%2BDsjXCg6e05lVG19%2FR8NkG1qHku021Q%2Fl980BclVKu%2FqzzCEeltU%2FbOGNuhWMZ9hxeVXrqtEsn2xeq8I82oHv%2Bf9UeY9WT48g%3D

# https://iv.jd.com/slide/s.html?d=0aC005emkd-pQx05y10u0000000000001w000000000c1010000023101000000j102000000g102000000g103000000i101000000f102000000i102000000g101000000h101000000h102000000g102000000g101000000i101000000l101000000h101000000g101000000U101000000E101101000o101000005M1010000009101000000f101000000h101000000g101000000h101000000t1010000009101000000c101101000h101000000h101000000h101000000h101000000g102000000g101101000o1010000009101000000h101000000h101000000m101000000f101000000E101000000g101000000g1010000060101101000g1010000007101000000h102000000i101000000C101000000J101000000g101000000h101000000h101000000V101101000g101000000g101000000g101000000U101000000D101000000h101000004o000101000f00000000eG&c=885822dac3274dd38f035b6db4afe699&w=272&appId=1604ebb2287&scene=login&product=embed&e=T73ALOOTXIGNCWD4MAIJZQHPPWYQXRF4BF36AUQBTP45OTUHDY2JBFHD5TKMI3PJPL25XYQARLO7XTMVXYGMGUNRRQ&s=501015335374100940&callback=jsonp_047642124722688206 HTTP/1.1
# jdSlide.js 里查找
authcode=67f065c63e8d46ccb260faab4f08253b


seqSid=6979121149284757584






loginname=shihongji123
_t=_t
loginType=c
useSlideAuthCode=1


# 页面获取
fp=a96a40f38165c031deedd4066516a583

# 页面获取
uuid=5a7fe5e5-f4e6-41a8-81f8-ad9aaf6ea57a

# 页面元素取值
pubKey=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDC7kw8r6tq43pwApYvkJ5laljaN9BZb21TAIfT%2FvexbobzH7Q8SUdP5uDPXEBKzOjx2L28y7Xs1d9v3tdPfKI2LR7PAzWBmDMn8riHrDDNpUpJnlAGUqJG9ooPn8j7YNpcxCa1iybOlc2kEhmJn5uwoanQq%2BCA6agNkqly2H4j6wIDAQAB


# 页面取值
sa_token=B68C442BE645754F33277E701208059080DD726A94A73F76DEC3053A838549C06EB7D3797CE1C5BBE7C2B2EF9CA7D4676F3D489984B517943EA13575FA80C7E7ACE37FCFF6F535F07B6FF67F57EA6A0581BD84EA37554047DF10ECB7C873652D89DB5CAEE8F1090FB49A29547319CF16FBF33734EFA4BF8F86849797883219C3E197A604140E904BA7E538273F59893FDF9BFD6EBA3121C9E3CD43FCF0A83781B5D843E1A8752E1E5E1074C564E94CE4748A310802D850DA23AFC85040A20E1E0816B742AB1223676A972EE0779E81C8FFB368498FB6BF43190E11BCC04B5B673BA9EED139026F63ABFCE04E880099CAEFC1A8C61853A8C20D4C26385A31532CDCD387A3E6912E88BF10A4016D6645F76F243B15A7C5CEE94CB10BF689DAA5A3DA812BAB6897927B3BD41A0C95CFEF6EC09E0E2918CB00F367D409DEB14E906190A6A6167177BE90C21AA6D5C5D0B9E4F72C2C6D599190EFE5F46B6382FB143DCCA063FCE30C274FC912B96C0A7E11B1F3594649BF9668A2DE114AC72C18411DBBB7DA1691942D83236B5882DAC5C6131EBEB3BFDAF4DC91E0037B6DA4E1F6A585B3913DAEC9AF11E395456CF3CB28D297A272BCB9D43AAC6C9E5B3CF18B497A01ACAB12AD13C3582957B9189CF7663F3DBAD91934FDC80FB1EEC1616B8270DB1FF69FE41FFE3CB99E726EEFB968E5D2046CFEBF68ECD1062E5B1FAA4716DE09E7B1476117BB40974BCF74329CD6E3B4DE9E7E0FD4E0A258E5AC55F692260FFBF328F1C1ADC0FC443FCAF3768F0CA76F70D95E10A3EE636B6E8B7FDF9C766058882B6D73E06EE4739032CC1E5A96CB3532828A489A625E0D3B31A8D95D06BD164DED4746811AD1E5DB3AF77513B8AF5146F0B802DB234B724FCFBE2B9A3D4424AF6CB4679F7B57DE57AF7296D404DFD1E544201C94EA440EB8E16BAC61747B0ADAD4DEA0677808AB7EB593C44B06098FA52172A3FE8DE7D25072BE9339148F268AA90973FC15EE61E98D6545721F4950BF428155F1B1E1E0F2FCBA3E16A186CF0824676A6620CF3AE693B99CC506E643CC5DA470DA4B6C069984126190FBDB46


# 页面取值
eid=T73ALOOTXIGNCWD4MAIJZQHPPWYQXRF4BF36AUQBTP45OTUHDY2JBFHD5TKMI3PJPL25XYQARLO7XTMVXYGMGUNRRQ




    目前没有弄明白 csdn 登录时，需要 fkid 参数的生成规则，不能登录成功

'''

import  requests, urllib
from bs4 import BeautifulSoup

header = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36'
}

login_page_url = 'https://passport.csdn.net/account/login'

requestLoginURL = 'https://passport.csdn.net/account/verify'

validateCode = None # 'https://passport.csdn.net/ajax/verifyhandler.ashx?rand=15335246503.99'

data = {

    'gps': '',
    'username': 'shihongji',
    'password': 'shihongji?!A25999',
    'rememberMe': 'true',
    'fkid': 'WHJMrwNw1k%2FEuGoY2Q2xsv4m043kwn2XYKIht1yXfFBjl6ZDWBPU9RZdE%2Bw522aJIRnbszZ18j%2FEP1HtpwU301YlfjxzEfEvOcBr9yySjCSTGaNpm6Xiy%2FpSD3EmPbcN1b2GXgZ5AQVIfxIfhRz7ENR%2Fww9utkHZcKyFCar%2BkROpkhoMiJ81hY2VkDSP4LI5G1S42CNvpqsMRTkAd7H%2FeWl9H8wGaTIOPOzDtm8KVrsWEfhZtCt1hcpn8hbF3LrabBYP2DI4NDfEEy5HbCBhxDd4A3puZnmpP1487582755342',
    '_eventId':'submit'
}

# 使用 requests 的 session 登录
se = requests.session()

response = se.get(login_page_url, headers = header, verify = False)

html = response.text
print(html)

# 以lxml 方式解析 HTML 内容
bfs = BeautifulSoup(html, 'lxml')

# 获取 name 是 lt 的 input 元素中的 value 值
lt = bfs.find('input',attrs={'name':'lt'}).get('value')
execution = bfs.find('input',attrs={'name':'execution'}).get('value')

data['lt'] = lt
data['execution'] = execution


yanzheng_img = bfs.find('img', attrs={'id':'yanzheng'})

if yanzheng_img:
    yanzheng =  yanzheng_img.get('src')

    res_yanzheng = requests.get(yanzheng, headers = header, verify = False)
    with open('d:/yanzheng.png','wb') as f:
        f.write(res_yanzheng. text)

    validateCode = raw_input('请输入验证码：')

    data['validateCode'] = validateCode


response = se.post(requestLoginURL, urllib.urlencode(data), headers = header, verify = False)

html = response.text

print(html)